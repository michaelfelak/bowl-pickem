<div class="reset-password-container">
  <div class="reset-password-card">
    <!-- Step 1: Verification -->
    <div *ngIf="step === 'verify'">
      <h1>Reset Password</h1>
      <p class="subtitle">Enter your username and registered email to verify your account</p>

      <form [formGroup]="verificationForm" (ngSubmit)="onVerify()" class="form">
        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-message">
          {{ errorMessage }}
        </div>

        <!-- Username Field -->
        <div class="form-group">
          <label for="username">Username</label>
          <input
            id="username"
            type="text"
            formControlName="username"
            placeholder="Enter your username"
            class="form-input"
            [class.invalid]="verificationUsername && verificationUsername.invalid && verificationUsername.touched"
          />
          <div *ngIf="verificationUsername && verificationUsername.invalid && verificationUsername.touched" class="error-text">
            <span *ngIf="verificationUsername.errors?.['required']">Username is required</span>
            <span *ngIf="verificationUsername.errors?.['minlength']">Username must be at least 3 characters</span>
          </div>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label for="email">Registered Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="Enter your registered email"
            class="form-input"
            [class.invalid]="verificationEmail && verificationEmail.invalid && verificationEmail.touched"
          />
          <div *ngIf="verificationEmail && verificationEmail.invalid && verificationEmail.touched" class="error-text">
            <span *ngIf="verificationEmail.errors?.['required']">Email is required</span>
            <span *ngIf="verificationEmail.errors?.['email']">Please enter a valid email address</span>
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="submit-btn"
          [disabled]="verificationForm.invalid || isLoading"
        >
          {{ isLoading ? 'Verifying...' : 'Verify Account' }}
        </button>
      </form>

      <!-- Back to Login -->
      <div class="back-link">
        <button type="button" class="back-btn" (click)="goBack()">
          Back to Login
        </button>
      </div>
    </div>

    <!-- Step 2: Reset Password -->
    <div *ngIf="step === 'reset'">
      <h1>Set New Password</h1>
      <p class="subtitle">Please enter your new password</p>

      <form [formGroup]="resetPasswordForm" (ngSubmit)="onResetPassword()" class="form">
        <!-- Success Message -->
        <div *ngIf="successMessage" class="success-message">
          {{ successMessage }}
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-message">
          {{ errorMessage }}
        </div>

        <!-- Password Field -->
        <div class="form-group">
          <label for="password">New Password</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            placeholder="Enter your new password"
            class="form-input"
            [class.invalid]="password && password.invalid && password.touched"
          />
          <div *ngIf="password && password.invalid && password.touched" class="error-text">
            <span *ngIf="password.errors?.['required']">Password is required</span>
            <span *ngIf="password.errors?.['minlength']">Password must be at least 6 characters</span>
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="passwordConfirm">Confirm Password</label>
          <input
            id="passwordConfirm"
            type="password"
            formControlName="passwordConfirm"
            placeholder="Confirm your new password"
            class="form-input"
            [class.invalid]="passwordConfirm && passwordConfirm.invalid && passwordConfirm.touched"
          />
          <div *ngIf="passwordConfirm && passwordConfirm.invalid && passwordConfirm.touched" class="error-text">
            <span *ngIf="passwordConfirm.errors?.['required']">Please confirm your password</span>
          </div>
          <div *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && resetPasswordForm.touched" class="error-text">
            Passwords do not match
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="submit-btn"
          [disabled]="resetPasswordForm.invalid || isLoading"
        >
          {{ isLoading ? 'Resetting Password...' : 'Reset Password' }}
        </button>
      </form>

      <!-- Back Button -->
      <div class="back-link">
        <button type="button" class="back-btn" (click)="goBack()">
          Back
        </button>
      </div>
    </div>
  </div>
</div>
