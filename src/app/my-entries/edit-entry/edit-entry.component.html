<div class="edit-entry-container">
  <!-- Header -->
  <div class="edit-header">
    <button class="back-btn" (click)="goBack()" title="Back to My Entries">
      ‚Üê Back to My Entries
    </button>
    <h1>Edit Entry</h1>
  </div>

  <!-- Success Alert -->
  <div *ngIf="showSuccess" class="success-alert">
    <strong>Success!</strong> {{ successMsg }}
  </div>

  <!-- Entry Summary -->
  <div *ngIf="entry && !isLoading" class="entry-summary">
    <span class="summary-item"><strong>{{ entry.name || entry.entry_name }}</strong></span>
    <span class="summary-item">Submitted: {{ formatDate(entry.timestamp || entry.created_date) }}</span>
  </div>

  <!-- Game Count Header -->
  <div class="game-count-header" *ngIf="!isLoading && picks.length > 0">
    <div class="game-count-item">
      <span class="game-count-label">Games Picked:</span>
      <span class="game-count-value">{{ gamesPicked }}/{{ totalGames }}</span>
    </div>
    <div class="game-count-item">
      <span class="game-count-label">3-Point Games:</span>
      <span class="game-count-value" [class.error]="threePointGames > maxThreePointGames">{{ threePointGames }}/{{ maxThreePointGames }}</span>
    </div>
    <div class="game-count-item">
      <span class="game-count-label">5-Point Games:</span>
      <span class="game-count-value" [class.error]="fivePointGames > maxFivePointGames">{{ fivePointGames }}/{{ maxFivePointGames }}</span>
    </div>
    <div class="game-count-item">
      <span class="game-count-label">10-Point Games:</span>
      <span class="game-count-value" [class.error]="tenPointGames > maxTenPointGames">{{ tenPointGames }}/{{ maxTenPointGames }}</span>
    </div>
    <div class="game-count-item">
      <span class="game-count-label">Total Possible Points:</span>
      <span class="game-count-value" style="font-weight: bold;">{{ totalPossiblePoints }} / {{ totalPossiblePoints }}</span>
    </div>
  </div>

  <!-- Picks Edit Table -->
  <div *ngIf="!isLoading && picks.length > 0" class="picks-edit-container">
    <form [formGroup]="pickForm">
      <table class="picks-edit-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Game</th>
            <th colspan="2" class="team-header">Team Selection</th>
            <th>Points</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pickControl of pickFormControls; let i = index" [formGroup]="pickControl" [class.locked-row]="!pickControl.get('isEditable')?.value">
            <td class="pick-number">{{ i + 1 }}</td>
            <td class="game-cell">
              <div class="bowl-name">{{ pickControl.get('gameLabel')?.value }}</div>
              <div class="game-teams">{{ pickControl.get('team_1_name')?.value }} vs {{ pickControl.get('team_2_name')?.value }}</div>
              <div class="game-time" *ngIf="pickControl.get('gameTime')?.value">
                <div><strong>Game Time:</strong> {{ pickControl.get('gameTime')?.value }}</div>
              </div>
              <div *ngIf="!pickControl.get('isEditable')?.value" class="status-badge" [class.finished]="pickControl.get('isFinished')?.value">{{ pickControl.get('isFinished')?.value ? 'Game Finished' : 'Game Started' }}</div>
            </td>
            
            <!-- Team 1 Selection -->
            <td class="team-cell">
              <button 
                *ngIf="pickControl.get('isEditable')?.value"
                type="button"
                class="team-btn"
                [class.selected]="isTeamSelected(i, 1)"
                (click)="togglePick(i, 1)"
                [title]="'Select ' + pickControl.get('team_1_name')?.value"
              >
                {{ pickControl.get('team_1_name')?.value }}
              </button>
              <span *ngIf="!pickControl.get('isEditable')?.value" class="team-text">
                {{ isTeamSelected(i, 1) ? pickControl.get('team_1_name')?.value : '-' }}
              </span>
            </td>

            <!-- Team 2 Selection -->
            <td class="team-cell">
              <button 
                *ngIf="pickControl.get('isEditable')?.value"
                type="button"
                class="team-btn"
                [class.selected]="isTeamSelected(i, 2)"
                (click)="togglePick(i, 2)"
                [title]="'Select ' + pickControl.get('team_2_name')?.value"
              >
                {{ pickControl.get('team_2_name')?.value }}
              </button>
              <span *ngIf="!pickControl.get('isEditable')?.value" class="team-text">
                {{ isTeamSelected(i, 2) ? pickControl.get('team_2_name')?.value : '-' }}
              </span>
            </td>

            <!-- Points Selection -->
            <td class="points-cell">
              <select 
                *ngIf="pickControl.get('isEditable')?.value"
                formControlName="points"
                class="points-select"
              >
                <option *ngFor="let point of getAvailablePoints(i)" [value]="point">
                  {{ point }} pt
                </option>
              </select>
              <span *ngIf="!pickControl.get('isEditable')?.value" class="points-text">
                <strong>{{ pickControl.get('points')?.value }}</strong>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </form>
  </div>

  <!-- Save Button -->
  <div *ngIf="!isLoading && picks.length > 0" class="button-group">
    <button class="save-btn" (click)="saveChanges()" [disabled]="isSaving || !validationResult?.isValid">
      {{ isSaving ? 'Saving...' : 'Save Changes' }}
    </button>
    <button class="cancel-btn" (click)="goBack()" [disabled]="isSaving" type="button">
      Cancel
    </button>
  </div>

  <!-- Error Alert -->
  <div *ngIf="showError" class="error-alert">
    <strong>Error:</strong> {{ errorMsg }}
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && picks.length === 0" class="empty-state">
    <p>No picks found for this entry.</p>
  </div>

  <!-- Confirmation Modal -->
  <app-edit-confirmation 
    *ngIf="showConfirmationModal"
    [changes]="confirmationChanges"
    [onConfirm]="confirmChanges.bind(this)"
    [onCancel]="cancelChanges.bind(this)">
  </app-edit-confirmation>
</div>
